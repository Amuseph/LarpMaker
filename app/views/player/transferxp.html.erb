<%= provide(:title, 'Transfer XP') %>
<div class="container col-12">
  <div class="pagetitle">Transfer XP</div>
  <div class="pagesubtitle" >Send XP to a Friend</div>

  <div class="container col-10">
    <div class="row bg-light">
      <div class="col-sm">
        Total Available XP: <%= available_xp %>
      </div>
      <div class="col-sm">
        Total Earned XP: <%= total_xp %>
      </div>
    </div>
  </div>

  <br>

  <%= bootstrap_form_for :xptransfer, url: player_transferxp_path do |f| %>
    <div class="row">
      <div class="container col-8">
        <%= f.text_field :emailaddress, :required => true, placeholder: 'Email Address', hide_label: true %>
      </div>
      <div class="container col-4">
        <button type="button" class="btn btn-secondary" id="validateemailbutton" onclick="validateEmail()">Validate Email</button>
      </div>
    </div>
    <p id ="emailvalidation"></p>
    <div class="row">
      <div class="container col-8">
        <%= f.text_field :amount, :required => true, placeholder: 'XP Amount', hide_label: true %>
      </div>
      <div class="container col-4">
      <button type="button" class="btn btn-secondary" id="validateamountbutton" onclick="validateAmount()" disabled>Validate Amount</button>
      </div>
    </div>
    <p id ="amountvalidation"></p>
    <%= link_to '<button type="button" class="btn btn-secondary">Back</button>'.html_safe, player_explog_path %>
    <button type="submit" class="btn btn-primary" id="submitbutton" disabled>Submit</button>
  <% end %>
</div>

<script>
  function validateEmail() {
    $.ajax({
      url: '/player/validateemail',
      type: 'GET',
      dataType: 'json',
      data: {email: document.getElementById('xptransfer_emailaddress').value},
      success: function(data){
        if (data.response == 'true') {
          document.getElementById("emailvalidation").innerHTML = 'Email Address Validated';
          $('#validateamountbutton').removeAttr('disabled');
          $('#xptransfer_emailaddress').prop('disabled', true);
          $('#validateemailbutton').prop('disabled', true);
        } else {
          document.getElementById("emailvalidation").innerHTML = 'Invalid Email Address';
        }

      }
    })
  }
  function validateAmount() {
    $.ajax({
      url: '/player/validatexpamount',
      type: 'GET',
      dataType: 'json',
      data: {xpamount: document.getElementById('xptransfer_amount').value},
      success: function(data){
        if (data.response == 'true') {
          document.getElementById("amountvalidation").innerHTML = 'XP Amount Validated';
          $('#submitbutton').removeAttr('disabled');
          $('#xptransfer_amount').prop('disabled', true);
          $('#validateamountbutton').prop('disabled', true);
        } else {
          document.getElementById("amountvalidation").innerHTML = 'Invalid XP Amount';
        }

      }
    })
  }
</script>