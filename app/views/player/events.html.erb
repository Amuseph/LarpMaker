<div class="container col-11">
<div class="pagetitle">Event Attendance</div>
<div class="pagesubtitle" >A Record of All Events Attended</div>

<table class="table table-striped table-bordered table-sm ">
  <thead class = 'thead-dark'>
  <tr>
      <th>Name</th>
      <th>Description</th>
      <th>Date</th>
      <th>Going As</th>
      <th>Meal Plan</th>
      <th>Character</th>
      <th>Feedback</th>
  </tr>
  </thead>
  <tbody>
    <% current_user.events.order('startdate desc').each do |event| %>
      <% eventattendance =  event.eventattendances.find_by(user_id: current_user) %>
        <tr class="table-light">
          <td><%= event.name %></td>
          <td><%= event.description %></td>
          
          <td><%= event.startdate %></td>
          <td><%= eventattendance.registrationtype %></td>
          <td><%= 
            if (eventattendance.mealplan.nil? || eventattendance.mealplan.empty? ) && event.mealplan? && event.startdate > Time.now && eventattendance.registrationtype == 'Player'
              link_to 'Buy A Meal Plan', event_mealplan_path(event.id)
            else
              eventattendance.mealplan 
            end
            %>
          </td>
          <td>
            <%= if ( eventattendance.character && event.startdate < Time.now) then
              eventattendance.character.name

            elsif (eventattendance.character && eventattendance.event.startdate > Time.now and eventattendance.registrationtype == 'Player') then
              link_to eventattendance.character.name, player_changeeventcharacter_path(:eventattendance_id => eventattendance.id), remote: true
            elsif (eventattendance.event.startdate > Time.now and eventattendance.registrationtype == 'Player') then
              link_to 'Assign Character',player_changeeventcharacter_path(:eventattendance_id => eventattendance.id), remote: true
            end
      
            %></td>
          <td><%= get_feedback_link(eventattendance.event) %></td>
        </tr>
      <% end %>
  </tbody>
</table>

<div id='changeEventCharacterDiv'>
  <%= render partial: 'player/modals/changeeventcharacter' %>
</div>